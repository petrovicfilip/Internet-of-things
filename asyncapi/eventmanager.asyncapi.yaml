asyncapi: 2.6.0
info:
  title: EventManager MQTT Subscriber/Publisher API
  version: 1.0.0
  description: EventManager sluša iot/readings i publikuje događaje na iot/events.
servers:
  mosquitto:
    url: mosquitto:1883
    protocol: mqtt
channels:
  iot/readings:
    subscribe:
      message:
        $ref: '#/components/messages/ReadingPublished'
  iot/events:
    publish:
      message:
        $ref: '#/components/messages/EventDetected'
components:
  messages:
    ReadingPublished:
      name: ReadingPublished
      payload:
        type: object
        required: [action, emitted_at, reading]
        properties:
          action: { type: string, enum: [created, updated, deleted] }
          emitted_at: { type: string, format: date-time }
          reading:
            $ref: '#/components/schemas/Reading'
    EventDetected:
      name: EventDetected
      payload:
        $ref: '#/components/schemas/Event'
  schemas:
    Reading:
      type: object
      required: [id, source_id, ts]
      properties:
        id: { type: string, format: uuid }
        source_id: { type: integer }
        ts: { type: string, format: date-time }
        temperature_c: { type: number }
        humidity_percent: { type: number }
        light_lux: { type: number }
        co2_ppm: { type: number }
        humidity_ratio: { type: number }
        occupancy: { type: boolean }
        location:
          type: object
          nullable: true
          properties:
            lat: { type: number }
            lon: { type: number }
    Event:
      type: object
      required: [event_id, event_type, detected_at, reading_id, source_id, ts, values]
      properties:
        event_id: { type: string, format: uuid }
        event_type: { type: string }
        detected_at: { type: string, format: date-time }
        reading_id: { type: string, format: uuid }
        source_id: { type: integer }
        ts: { type: string, format: date-time }
        values: { type: object }
        location:
          type: object
          nullable: true
          properties:
            lat: { type: number }
            lon: { type: number }